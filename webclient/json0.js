(function(){var e={exports:{}},n=e.exports;n._bootstrapTransform=function(e,n,r,t){var l,i;return l=function(e,r,t,l){return n(t,e,r,"left"),n(l,r,e,"right")},e.transformX=e.transformX=i=function(e,n){var p,o,f,s,a,c,u,d,h,m,g,v,w,O,b,y,k,j,E;for(r(e),r(n),a=[],m=0,O=n.length;O>m;m++){for(h=n[m],s=[],p=0;e.length>p;){if(c=[],l(e[p],h,s,c),p++,1!==c.length){if(0===c.length){for(j=e.slice(p),g=0,b=j.length;b>g;g++)o=j[g],t(s,o);h=null;break}for(E=i(e.slice(p),c),f=E[0],d=E[1],v=0,y=f.length;y>v;v++)o=f[v],t(s,o);for(w=0,k=d.length;k>w;w++)u=d[w],t(a,u);h=null;break}h=c[0]}null!=h&&t(a,h),e=s}return[e,a]},e.transform=e.transform=function(e,r,t){if("left"!==t&&"right"!==t)throw Error("type must be 'left' or 'right'");return 0===r.length?e:1===e.length&&1===r.length?n([],e[0],r[0],t):"left"===t?i(e,r)[0]:i(r,e)[1]}},function(){var r=Object.prototype.toString,t=function(e){return void 0===e},l=function(e){return void 0!==e},i=function(e){return"[object String]"==r.call(e)},p=function(e){return"[object Number]"==r.call(e)},o=function(e){return"[object Array]"==r.call(e)},f=function(e){return JSON.parse(JSON.stringify(e))},s="undefined"!=typeof window&&null!==window?window.ottypes.text:require("./text-old"),a={};a.name="json0",a.uri="http://sharejs.org/types/JSONv0",a.create=function(){return null},a.invertComponent=function(e){var n={p:e.p};return l(e.si)&&(n.sd=e.si),l(e.sd)&&(n.si=e.sd),l(e.oi)&&(n.od=e.oi),l(e.od)&&(n.oi=e.od),l(e.li)&&(n.ld=e.li),l(e.ld)&&(n.li=e.ld),l(e.na)&&(n.na=-e.na),l(e.lm)&&(n.lm=e.p[e.p.length-1],n.p=e.p.slice(0,e.p.length-1).concat([e.lm])),n},a.invert=function(e){for(var n=e.slice().reverse(),r=[],t=0;n.length>t;t++)r.push(a.invertComponent(n[t]));return r},a.checkValidOp=function(){},a.checkList=function(e){if(!o(e))throw Error("Referenced element not a list")},a.checkObj=function(e){if(e.constructor!==Object)throw Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},a.apply=function(e,n){a.checkValidOp(n),n=f(n);for(var r={data:e},t=0;n.length>t;t++){for(var o=n[t],s=null,c=null,u=r,d="data",h=0;o.p.length>h;h++){var m=o.p[h];if(s=u,c=d,u=u[d],d=m,null==s)throw Error("Path invalid")}if(l(o.na)){if(!p(u[d]))throw Error("Referenced element not a number");u[d]+=o.na}else if(l(o.si)){if(!i(u))throw Error("Referenced element not a string (it was "+JSON.stringify(u)+")");s[c]=u.slice(0,d)+o.si+u.slice(d)}else if(l(o.sd)){if(!i(u))throw Error("Referenced element not a string");if(u.slice(d,d+o.sd.length)!==o.sd)throw Error("Deleted string does not match");s[c]=u.slice(0,d)+u.slice(d+o.sd.length)}else if(l(o.li)&&l(o.ld))a.checkList(u),u[d]=o.li;else if(l(o.li))a.checkList(u),u.splice(d,0,o.li);else if(l(o.ld))a.checkList(u),u.splice(d,1);else if(l(o.lm)){if(a.checkList(u),o.lm!=d){var g=u[d];u.splice(d,1),u.splice(o.lm,0,g)}}else if(l(o.oi))a.checkObj(u),u[d]=o.oi;else{if(!l(o.od))throw Error("invalid / missing instruction in op");a.checkObj(u),delete u[d]}}return r.data},a.pathMatches=function(e,n,r){if(e.length!=n.length)return!1;for(var t=0;e.length>t;t++){var l=e[t];if(l!==n[t]&&(!r||t!==e.length-1))return!1}return!0},a.append=function(e,n){n=f(n);var r;return 0!=e.length&&a.pathMatches(n.p,(r=e[e.length-1]).p)?l(r.na)&&l(n.na)?e[e.length-1]={p:r.p,na:r.na+n.na}:l(r.li)&&t(n.li)&&n.ld===r.li?l(r.ld)?delete r.li:e.pop():l(r.od)&&t(r.oi)&&l(n.oi)&&t(n.od)?r.oi=n.oi:l(n.lm)&&n.p[n.p.length-1]===n.lm?null:e.push(n):e.push(n)},a.compose=function(e,n){a.checkValidOp(e),a.checkValidOp(n);for(var r=f(e),t=0;n.length>t;t++)a.append(r,n[t]);return r},a.normalize=function(e){var n=[];e=o(e)?e:[e];for(var r=0;e.length>r;r++){var t=e[r];null==t.p&&(t.p=[]),a.append(n,t)}return n},a.canOpAffectOp=function(e,n){if(0===e.length)return!0;if(0===n.length)return!1;n=n.slice(0,n.length-1),e=e.slice(0,e.length-1);for(var r=0;e.length>r;r++){var t=e[r];if(r>=n.length)return!1;if(t!=n[r])return!1}return!0},a.transformComponent=function(e,n,r,i){var p,o,c,u,d;n=f(n),l(n.na)&&n.p.push(0),l(r.na)&&r.p.push(0),a.canOpAffectOp(r.p,n.p)&&(p=r.p.length-1),a.canOpAffectOp(n.p,r.p)&&(o=n.p.length-1);var h=n.p.length,m=r.p.length;if(l(n.na)&&n.p.pop(),l(r.na)&&r.p.pop(),r.na)return null!=o&&m>=h&&r.p[o]==n.p[o]&&(l(n.ld)?(c=f(r),c.p=c.p.slice(h),n.ld=a.apply(f(n.ld),[c])):l(n.od)&&(c=f(r),c.p=c.p.slice(h),n.od=a.apply(f(n.od),[c]))),a.append(e,n),e;if(null!=o&&m>h&&n.p[o]==r.p[o]&&(l(n.ld)?(c=f(r),c.p=c.p.slice(h),n.ld=a.apply(f(n.ld),[c])):l(n.od)&&(c=f(r),c.p=c.p.slice(h),n.od=a.apply(f(n.od),[c]))),null!=p){var g=h==m;if(l(r.na));else if(l(r.si)||l(r.sd)){if(l(n.si)||l(n.sd)){if(!g)throw Error("must be a string?");var v=function(e){var n={p:e.p[e.p.length-1]};return null!=e.si?n.i=e.si:n.d=e.sd,n},w=v(n),O=v(r),b=[];s._tc(b,w,O,i);for(var y=0;b.length>y;y++){var k=b[y],j={p:n.p.slice(0,p)};j.p.push(k.p),null!=k.i&&(j.si=k.i),null!=k.d&&(j.sd=k.d),a.append(e,j)}return e}}else if(l(r.li)&&l(r.ld)){if(r.p[p]===n.p[p]){if(!g)return e;if(l(n.ld)){if(!l(n.li)||"left"!==i)return e;n.ld=f(r.li)}}}else if(l(r.li))l(n.li)&&t(n.ld)&&g&&n.p[p]===r.p[p]?"right"===i&&n.p[p]++:r.p[p]<=n.p[p]&&n.p[p]++,l(n.lm)&&g&&r.p[p]<=n.lm&&n.lm++;else if(l(r.ld)){if(l(n.lm)&&g){if(r.p[p]===n.p[p])return e;var E=r.p[p];u=n.p[p],d=n.lm,(d>E||E===d&&d>u)&&n.lm--}if(r.p[p]<n.p[p])n.p[p]--;else if(r.p[p]===n.p[p]){if(h>m)return e;if(l(n.ld)){if(!l(n.li))return e;delete n.ld}}}else if(l(r.lm))if(l(n.lm)&&h===m){u=n.p[p],d=n.lm;var S=r.p[p],x=r.lm;if(S!==x)if(u===S){if("left"!==i)return e;n.p[p]=x,u===d&&(n.lm=x)}else u>S&&n.p[p]--,u>x?n.p[p]++:u===x&&S>x&&(n.p[p]++,u===d&&n.lm++),d>S?n.lm--:d===S&&d>u&&n.lm--,d>x?n.lm++:d===x&&(x>S&&d>u||S>x&&u>d?"right"===i&&n.lm++:d>u?n.lm++:d===S&&n.lm--)}else l(n.li)&&t(n.ld)&&g?(u=r.p[p],d=r.lm,E=n.p[p],E>u&&n.p[p]--,E>d&&n.p[p]++):(u=r.p[p],d=r.lm,E=n.p[p],E===u?n.p[p]=d:(E>u&&n.p[p]--,E>d?n.p[p]++:E===d&&u>d&&n.p[p]++));else if(l(r.oi)&&l(r.od)){if(n.p[p]===r.p[p]){if(!l(n.oi)||!g)return e;if("right"===i)return e;n.od=r.oi}}else if(l(r.oi)){if(l(n.oi)&&n.p[p]===r.p[p]){if("left"!==i)return e;a.append(e,{p:n.p,od:r.oi})}}else if(l(r.od)&&n.p[p]==r.p[p]){if(!g)return e;if(!l(n.oi))return e;delete n.od}}return a.append(e,n),e},"undefined"!=typeof window&&null!==window?n._bootstrapTransform(a,a.transformComponent,a.checkValidOp,a.append):require("./helpers")._bootstrapTransform(a,a.transformComponent,a.checkValidOp,a.append),e.exports=a}.call(this);var r=window.ottypes=window.ottypes||{},t=e.exports;r[t.name]=t,t.uri&&(r[t.uri]=t)})();